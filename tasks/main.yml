---
# tasks file for roles/ice

- name: Load ice variables
  include_vars: ice-{{ ice_version }}.yml

- name: zeroc ice | setup repository
  become: true
  get_url:
    dest: /etc/yum.repos.d/zeroc-ice-el7.repo
    url: "{{ ice_repourl }}"

- name: zeroc ice | install runtime packages
  become: true
  yum:
    name: "{{ item }}"
    state: present
  with_items: "{{ ice_runtime_packages }}"

- name: zeroc ice | install devel packages
  become: true
  yum:
    name: "{{ item }}"
    state: present
  with_items: "{{ ice_devel_packages }}"
  when: ice_install_devel

- name: zeroc ice | install ice pip dependencies
  become: true
  yum:
    name: "{{ item }}"
    state: present
  with_items: "{{ ice_pip_dependencies }}"
  when: >-
    ice_install_python and
    ice_pip_dependencies and (ice_python_wheel | length < 1)

- name: zeroc ice | pip install packages
  become: true
  pip:
    name: "{{ ice_pip_packages }}"
    state: present
  when: >-
    ice_install_python and
    ice_pip_dependencies and (ice_python_wheel | length < 1)

- name: zeroc ice | install python-pip for wheel
  become: true
  yum:
    name: python-pip
    state: present
  when: ice_install_python and (ice_python_wheel | length >= 1)

- name: zeroc ice | install ice wheel package
  become: true
  pip:
    name: "{{ ice_python_wheel }}"
    state: present
  when: ice_install_python and (ice_python_wheel | length >= 1)
